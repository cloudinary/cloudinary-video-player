<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breakpoints - Cloudinary Video Player</title>
  <link href="https://res.cloudinary.com/cloudinary-marketing/image/upload/f_auto,q_auto/c_scale,w_32/v1597183771/creative_staging/cloudinary_internal/Website/Brand%20Updates/Favicon/cloudinary_web_favicon_192x192.png" rel="icon" type="image/png">

  <!-- Bootstrap -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script type="text/javascript" src="scripts.js"></script>

  <style>
    .player-container {
      margin-bottom: 30px;
      padding: 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: #f8f9fa;
    }
    .player-info {
      margin-top: 15px;
      padding: 15px;
      background: #fff;
      border-radius: 5px;
      font-family: monospace;
      font-size: 14px;
    }
    .player-info strong {
      color: #0066cc;
    }
    .comparison-container {
      display: flex;
      gap: 20px;
      margin-top: 30px;
    }
    .comparison-item {
      flex: 1;
    }
    @media (max-width: 768px) {
      .comparison-container {
        flex-direction: column;
      }
    }
    .badge-custom {
      display: inline-block;
      padding: 5px 10px;
      margin: 5px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    .badge-dpr-1 { background: #28a745; color: white; }
    .badge-dpr-15 { background: #ffc107; color: black; }
    .badge-dpr-2 { background: #dc3545; color: white; }
  </style>

  <script type="text/javascript">
    let players = {};

    window.addEventListener('load', function(){
      
      // Example 1: Basic Breakpoints (DPR 1.0 - Default)
      players.basic = cloudinary.videoPlayer('player-basic', {
        cloudName: 'demo',
        breakpoints: true,
        dpr: 1.0
      });

      players.basic.source('sea_turtle', {
        info: { title: 'Basic Breakpoints (DPR 1.0)', subtitle: 'Standard quality' }
      });
      
      players.basic.on('sourcechanged', () => displayPlayerInfo());

      // Example 2: High DPI (DPR 1.5)
      players.highDpi = cloudinary.videoPlayer('player-high-dpi', {
        cloudName: 'demo',
        breakpoints: true,
        dpr: 1.5
      });

      players.highDpi.source('sea_turtle', {
        info: { title: 'High DPI (DPR 1.5)', subtitle: 'Enhanced quality' }
      });
      
      players.highDpi.on('sourcechanged', () => displayPlayerInfo());

      // Example 3: Retina Display (DPR 2.0)
      players.retina = cloudinary.videoPlayer('player-retina', {
        cloudName: 'demo',
        breakpoints: true,
        dpr: 2.0
      });

      players.retina.source('sea_turtle', {
        info: { title: 'Retina Display (DPR 2.0)', subtitle: 'Maximum quality' }
      });
      
      players.retina.on('sourcechanged', () => displayPlayerInfo());

      // Example 4: Without Breakpoints (for comparison)
      players.noBreakpoints = cloudinary.videoPlayer('player-no-breakpoints', {
        cloudName: 'demo'
        // No breakpoints config
      });

      players.noBreakpoints.source('sea_turtle', {
        info: { title: 'Without Breakpoints', subtitle: 'Original behavior' }
      });
      
      players.noBreakpoints.on('sourcechanged', () => displayPlayerInfo());

      // Example 5: Simple Enable
      players.custom = cloudinary.videoPlayer('player-custom', {
        cloudName: 'demo',
        breakpoints: true  // Enabled with default DPR (1.0)
      });

      players.custom.source('sea_turtle', {
        info: { title: 'Simple Enable', subtitle: 'Default configuration (DPR 1.0)' }
      });
      
      players.custom.on('sourcechanged', () => displayPlayerInfo());

      // Example 6: Side-by-side comparison
      players.compare1 = cloudinary.videoPlayer('player-compare-1', {
        cloudName: 'demo',
        breakpoints: true,
        dpr: 1.0
      });

      players.compare1.source('sea_turtle');
      players.compare1.on('sourcechanged', () => displayPlayerInfo());

      players.compare2 = cloudinary.videoPlayer('player-compare-2', {
        cloudName: 'demo',
        breakpoints: true,
        dpr: 2.0
      });

      players.compare2.source('sea_turtle');
      players.compare2.on('sourcechanged', () => displayPlayerInfo());

    }, false);

    function displayPlayerInfo() {
      Object.keys(players).forEach(key => {
        const player = players[key];
        const infoId = `info-${key}`;
        const infoEl = document.getElementById(infoId);
        
        if (infoEl && player.el() && player.cloudinary) {
          const containerWidth = player.el().parentElement.clientWidth;
          const source = player.cloudinary.source();
          const breakpointsEnabled = source && typeof source.breakpoints === 'function' ? source.breakpoints() : false;
          const dpr = source && typeof source.dpr === 'function' ? source.dpr() : null;
          const currentSrc = player.currentSource()?.src || 'N/A';
          
          // Extract width from URL if present
          const widthMatch = currentSrc.match(/w_(\d+)/);
          const appliedWidth = widthMatch ? widthMatch[1] : 'auto';
          
          let html = `
            <strong>Container Width:</strong> ${containerWidth}px<br>
            <strong>Breakpoints Enabled:</strong> ${breakpointsEnabled ? 'Yes' : 'No'}<br>
          `;
          
          if (breakpointsEnabled && dpr) {
            const effectiveDpr = Math.min(dpr, 2.0);
            const requiredWidth = Math.round(containerWidth * effectiveDpr);
            
            html += `
              <strong>DPR:</strong> ${dpr}<br>
              <strong>Effective DPR:</strong> ${effectiveDpr}<br>
              <strong>Required Width:</strong> ${requiredWidth}px<br>
              <strong>Applied Width:</strong> ${appliedWidth}px<br>
            `;
          }
          
          html += `<strong>Source URL:</strong> <small>${currentSrc.substring(0, 100)}...</small>`;
          
          infoEl.innerHTML = html;
        }
      });
    }

    // Update info on window resize (for demonstration)
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(displayPlayerInfo, 500);
    });
  </script>

</head>
<body>

  <div class="container p-4">
    <h1 class="mb-4">Breakpoints - Responsive Video Resolution</h1>
    
    <div class="alert alert-info">
      <strong>What are Breakpoints?</strong><br>
      Breakpoints automatically select the optimal video resolution based on your container width and device pixel ratio (DPR).
      This ensures sharp playback without over-serving bandwidth.
      <br><br>
      <strong>Key Features:</strong>
      <ul class="mb-0">
        <li>Automatic resolution selection based on container size</li>
        <li>DPR support for high-density displays (1.0, 1.5, 2.0)</li>
        <li>Bandwidth optimization - serve only what's needed</li>
        <li>Calculated once on load - no dynamic resizing</li>
      </ul>
    </div>

    <!-- Example 1: Basic Breakpoints -->
    <div class="player-container">
      <h3>
        Example 1: Basic Breakpoints
        <span class="badge-custom badge-dpr-1">DPR 1.0</span>
      </h3>
      <p>Standard quality for regular displays. Most bandwidth-efficient option.</p>
      
      <video
        id="player-basic"
        controls
        muted
        class="cld-video-player cld-video-player-skin-dark cld-fluid">
      </video>
      
      <div class="player-info" id="info-basic">Loading...</div>
      
      <details class="mt-3">
        <summary><strong>View Code</strong></summary>
        <pre><code>const player = cloudinary.videoPlayer('player', {
  cloudName: 'demo',
  breakpoints: true,
  dpr: 1.0  // Standard quality
});

player.source('sea_turtle');</code></pre>
      </details>
    </div>

    <!-- Example 2: High DPI -->
    <div class="player-container">
      <h3>
        Example 2: High DPI Displays
        <span class="badge-custom badge-dpr-15">DPR 1.5</span>
      </h3>
      <p>Enhanced quality for high-DPI displays. Balanced quality and bandwidth.</p>
      
      <video
        id="player-high-dpi"
        controls
        muted
        class="cld-video-player cld-video-player-skin-dark cld-fluid">
      </video>
      
      <div class="player-info" id="info-highDpi">Loading...</div>
      
      <details class="mt-3">
        <summary><strong>View Code</strong></summary>
        <pre><code>const player = cloudinary.videoPlayer('player', {
  cloudName: 'demo',
  breakpoints: true,
  dpr: 1.5  // Enhanced quality
});

player.source('sea_turtle');</code></pre>
      </details>
    </div>

    <!-- Example 3: Retina Display -->
    <div class="player-container">
      <h3>
        Example 3: Retina Displays
        <span class="badge-custom badge-dpr-2">DPR 2.0</span>
      </h3>
      <p>Maximum quality for Retina and high-density displays. Perfect pixel-to-pixel rendering.</p>
      
      <video
        id="player-retina"
        controls
        muted
        class="cld-video-player cld-video-player-skin-dark cld-fluid">
      </video>
      
      <div class="player-info" id="info-retina">Loading...</div>
      
      <details class="mt-3">
        <summary><strong>View Code</strong></summary>
        <pre><code>const player = cloudinary.videoPlayer('player', {
  cloudName: 'demo',
  breakpoints: true,
  dpr: 2.0  // Maximum quality
});

player.source('sea_turtle');</code></pre>
      </details>
    </div>

    <!-- Example 4: Without Breakpoints -->
    <div class="player-container">
      <h3>Example 4: Without Breakpoints (Comparison)</h3>
      <p>Default behavior without breakpoints - serves original video dimensions.</p>
      
      <video
        id="player-no-breakpoints"
        controls
        muted
        class="cld-video-player cld-video-player-skin-dark cld-fluid">
      </video>
      
      <div class="player-info" id="info-noBreakpoints">Loading...</div>
      
      <details class="mt-3">
        <summary><strong>View Code</strong></summary>
        <pre><code>const player = cloudinary.videoPlayer('player', {
  cloudName: 'demo'
  // No breakpoints configuration
});

player.source('sea_turtle');</code></pre>
      </details>
    </div>

    <!-- Example 5: Simple Enable -->
    <div class="player-container">
      <h3>Example 5: Simple Enable with Defaults</h3>
      <p>Enable breakpoints with just <code>breakpoints: true</code> - uses DPR 1.0 by default.</p>
      
      <video
        id="player-custom"
        controls
        muted
        class="cld-video-player cld-video-player-skin-dark cld-fluid">
      </video>
      
      <div class="player-info" id="info-custom">Loading...</div>
      
      <details class="mt-3">
        <summary><strong>View Code</strong></summary>
        <pre><code>const player = cloudinary.videoPlayer('player', {
  cloudName: 'demo',
  breakpoints: true  // Enabled with default DPR (1.0)
});

player.source('sea_turtle');</code></pre>
      </details>
    </div>

    <!-- Example 6: Side-by-side Comparison -->
    <h2 class="mt-5 mb-4">Side-by-Side Comparison</h2>
    <p>Compare DPR 1.0 vs DPR 2.0 side-by-side. Notice the difference in applied width transformations.</p>
    
    <div class="comparison-container">
      <div class="comparison-item">
        <div class="player-container">
          <h4>DPR 1.0 <span class="badge-custom badge-dpr-1">Standard</span></h4>
          <video
            id="player-compare-1"
            controls
            muted
            class="cld-video-player cld-video-player-skin-dark cld-fluid">
          </video>
          <div class="player-info" id="info-compare1">Loading...</div>
        </div>
      </div>
      
      <div class="comparison-item">
        <div class="player-container">
          <h4>DPR 2.0 <span class="badge-custom badge-dpr-2">Retina</span></h4>
          <video
            id="player-compare-2"
            controls
            muted
            class="cld-video-player cld-video-player-skin-dark cld-fluid">
          </video>
          <div class="player-info" id="info-compare2">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Configuration Reference -->
    <h2 class="mt-5 mb-4">Configuration Reference</h2>
    <div class="alert alert-secondary">
      <h5>Breakpoint Options</h5>
      <table class="table table-sm table-bordered bg-white">
        <thead>
          <tr>
            <th>Option</th>
            <th>Type</th>
            <th>Default</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>dpr</code></td>
            <td>Number</td>
            <td>1.0</td>
            <td>Device Pixel Ratio: 1.0, 1.5, or 2.0</td>
          </tr>
        </tbody>
      </table>
      
      <div class="alert alert-info mt-3">
        <strong>Note:</strong> Renditions ([640, 1280, 1920, 3840]) and max width (3840px/4K) are fixed for optimal performance and cannot be customized.
      </div>

      <h5 class="mt-4">How It Works</h5>
      <ol>
        <li><strong>Measure Container:</strong> Automatically uses the player's parent element width</li>
        <li><strong>Apply DPR:</strong> Multiply container width by DPR (capped at 2.0)</li>
        <li><strong>Select Rendition:</strong> Choose the smallest rendition ≥ required width</li>
        <li><strong>Apply Transformation:</strong> Add <code>w_XXX,c_limit</code> to video URL</li>
      </ol>

      <h5 class="mt-4">Example Calculation</h5>
      <pre class="bg-light p-3"><code>Container Width: 500px
DPR: 2.0
Required Width: 500 × 2.0 = 1000px
Selected Rendition: 1280px (smallest ≥ 1000px)
Transformation: w_1280,c_limit,q_auto,f_auto</code></pre>
    </div>

    <!-- Per-Source Configuration -->
    <h2 class="mt-5 mb-4">Per-Source Configuration</h2>
    <div class="alert alert-info">
      <p>You can also configure breakpoints per video source:</p>
      <pre><code>player.source('my-video', {
  breakpoints: true,
  dpr: 2.0  // Override for this video only
});</code></pre>
    </div>

    <!-- Back to Examples -->
    <p class="mt-5">
      <a href="./index.html">← Back to Examples</a>
    </p>

  </div>

</body>
</html>
